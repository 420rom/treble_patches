From dba6ee9400e55b89a8eaced0c18bf68550ee7e32 Mon Sep 17 00:00:00 2001
From: Pierre-Hugues Husson <phh@phh.me>
Date: Fri, 5 Jun 2020 20:05:31 +0200
Subject: [PATCH 21/25] Support unexpected onAuthenticated

Xiaomi Mi 8 SE send onAuthenticated during enroll
(NO I HAVE NO IDEA WHY)
In that case performance stats object doesn't exist (yet), ignore.
---
 .../server/biometrics/BiometricServiceBase.java        | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/services/core/java/com/android/server/biometrics/BiometricServiceBase.java b/services/core/java/com/android/server/biometrics/BiometricServiceBase.java
index fd77ada1109..cf16c7b170b 100644
--- a/services/core/java/com/android/server/biometrics/BiometricServiceBase.java
+++ b/services/core/java/com/android/server/biometrics/BiometricServiceBase.java
@@ -733,10 +733,12 @@ public abstract class BiometricServiceBase extends SystemService
         if (client != null && client.onAuthenticated(identifier, authenticated, token)) {
             removeClient(client);
         }
-        if (authenticated) {
-            mPerformanceStats.accept++;
-        } else {
-            mPerformanceStats.reject++;
+        if(mPerformanceStats != null) {
+            if (authenticated) {
+                mPerformanceStats.accept++;
+            } else {
+                mPerformanceStats.reject++;
+            }
         }
     }
 
-- 
2.17.1

